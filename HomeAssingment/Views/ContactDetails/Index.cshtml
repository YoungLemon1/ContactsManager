@model HomeAssignment.Models.Contact

<div>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>

		var editing = false;
		var originalValues = {};

		function ToggleEditingMode() {
			const contactFields = document.querySelectorAll("input:not(#id)");
			const editBtn = document.getElementById("edit-btn");
			const saveBtn = document.getElementById("save-btn");

			if (editing) {
				let valuesChanged = false;
				contactFields.forEach((field) => {
					if (field.value !== originalValues[field.id]) {
						valuesChanged = true;
					}
					field.setAttribute("readonly", "true");
				});

				if (valuesChanged) {
					if (!confirm("Are you sure you want to exit edit mode without saving?")) {
						// User cancelled, go back into editing mode
						editing = true;
						return;
					}
				}

				contactFields.forEach((field) => {

					editBtn.textContent = "Edit ✏";
					editBtn.classList.add("btn-warning");
					editBtn.classList.remove("btn-danger");
					field.setAttribute("readonly", "true");
					field.value = originalValues[field.id];
					saveBtn.setAttribute("hidden", "hidden");
				});
			}
			else {
				contactFields.forEach((field) => {
					originalValues[field.id] = field.value;
					editBtn.textContent = "X";
					editBtn.classList.add("btn-danger");
					editBtn.classList.remove("btn-warning");
					field.removeAttribute("readonly");
					saveBtn.removeAttribute("hidden");
				});
			}
			editing = !editing;
		}
	</script>

	<h2>@Model.FirstName @Model.LastName</h2>
	<div class="error-message">@TempData["ErrorMessage"]</div>
	<form asp-action="SaveEdit" class="form-control" id="edit-contact-form">
		<button id="edit-btn" type="button" class="btn btn-warning" onclick="ToggleEditingMode()">Edit ✏</button>
		<div>
			<label for="id">Id</label>
			<input id="id" name="id" type="text" asp-for=Id maxlength="9" pattern="[0-9]{9}" required readonly />
			<span asp-validation-for="Id" class="text-danger"></span>
		</div>
		<div>
			<label for="first-name">First Name</label>
			<input id="first-name" type="text" asp-for=FirstName maxlength="15" pattern="[A-Za-z\s\-]{2,}" title="First name should be at least 2 letters long" required readonly />
			<span asp-validation-for="FirstName" class="text-danger"></span>
		</div>
		<div>
			<label for="last-name">Last Name</label>
			<input id="last-name" type="text" asp-for=LastName maxlength="15" pattern="[A-Za-z\s\-]{2,}" title="Last name should be at least 2 letters long" required readonly />
			<span asp-validation-for="LastName" class="text-danger"></span>
		</div>
		<div>
			<label for="birth-date">Birth Date</label>
			<input id="birth-date" type="date" asp-for=BirthDate readonly />
			<span asp-validation-for="BirthDate" class="text-danger"></span>
		</div>
		<div>
			<label for="city">City</label>
			<input id="city" type="text" asp-for=City maxlength="20" pattern="[A-Za-z\s\-]{2,}" title="City name should be at least 2 letters long" readonly />
			<span asp-validation-for="City" class="text-danger"></span>
		</div>
		<div>
			<label for="street">Street</label>
			<input id="street" type="text" asp-for=Street maxlength="20" pattern="[A-Za-z\s\-]{2,}" title="Street name should be at least 2 letters long" readonly />
			<span asp-validation-for="Street" class="text-danger"></span>
		</div>
		<div>
			<label for="house-number">House Number</label>
			<input id="house-number" type="number" asp-for=HouseNumber maxlength="4" pattern="[0-9]+" readonly />
			<span asp-validation-for="HouseNumber" class="text-danger"></span>
		</div>
		<div>
			<label for="phone-at-home">Phone at Home</label>
			<input id="phone-at-home" type="text" asp-for=PhoneAtHome maxlength="20" pattern="[0-9\-\+\()]+" title="Phone at home cannot include letters" readonly />
			<span asp-validation-for="PhoneAtHome" class="text-danger"></span>
		</div>
		<div>
			<label for="phone">Phone</label>
			<input id="phone" type="text" asp-for=Phone maxlength="20" pattern="[0-9\-\+\()]+" title="Phone cannot include letters" readonly />
			<span asp-validation-for="Phone" class="text-danger"></span>
		</div>
		<div>
			<button id="save-btn" type="submit" class="btn btn-success" hidden>Save</button>
		</div>
	</form>
</div>

